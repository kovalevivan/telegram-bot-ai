{% extends "base.html" %}
{% block content %}
<div class="d-flex align-items-center justify-content-between mb-3">
  <h1 class="h4 mb-0">
    {% if mode == "create" %}Новый промт{% else %}Промт: <code>{{ prompt.slug }}</code>{% endif %}
  </h1>
  <div class="d-flex gap-2">
    {% if mode != "create" %}
      <a class="btn btn-outline-primary" href="/ui/prompts/{{ prompt.slug }}/test">Test</a>
    {% endif %}
    <a class="btn btn-outline-secondary" href="/ui/prompts">Назад</a>
  </div>
</div>

{% if error %}
  <div class="alert alert-danger">{{ error }}</div>
{% endif %}

<div class="card shadow-sm">
  <div class="card-body">
    {% if mode == "create" %}
      <form method="post" action="/ui/prompts/new">
    {% else %}
      <form method="post" action="/ui/prompts/{{ prompt.slug }}">
    {% endif %}

      {% if mode == "create" %}
      <div class="mb-3">
        <label class="form-label">slug (prompt_id)</label>
        <input class="form-control" name="slug" value="{{ (prompt.slug if prompt else '') }}" required>
        <div class="form-text">Идентификатор промта, который будете передавать из Puzzlebot.</div>
      </div>
      {% endif %}

      <div class="mb-3">
        <label class="form-label">Название</label>
        <input class="form-control" name="name" value="{{ (prompt.name if prompt else '') }}" required>
      </div>

      <div class="row">
        <div class="col-md-4 mb-3">
          <label class="form-label">Provider</label>
          <input class="form-control" name="provider" value="{{ (prompt.provider if prompt else 'openai') }}">
        </div>
        <div class="col-md-8 mb-3">
          <label class="form-label">Model</label>
          <input class="form-control" name="model" value="{{ (prompt.model if prompt else 'gpt-4o-mini') }}" required>
        </div>
      </div>

      <div class="row">
        <div class="col-md-4 mb-3">
          <label class="form-label">Temperature</label>
          <input class="form-control" type="number" step="0.1" name="temperature" value="{{ (prompt.temperature if prompt else 0.2) }}">
        </div>
        <div class="col-md-4 mb-3">
          <label class="form-label">Max tokens</label>
          <input class="form-control" type="number" name="max_tokens" value="{{ (prompt.max_tokens if prompt else 512) }}">
          <div class="form-text">Поставьте <code>0</code>, чтобы не отправлять лимит в запросе к LLM.</div>
        </div>
      </div>

      <div class="mb-3">
        <label class="form-label">System template (опционально)</label>
        <textarea class="form-control" name="system_template" rows="4">{{ (prompt.system_template if prompt and prompt.system_template else '') }}</textarea>
        <div class="form-text">Jinja2 шаблон. Пример: <code>Ты помощник. Отвечай коротко.</code></div>
      </div>

      <div class="mb-3">
        <label class="form-label">User template</label>
        <textarea class="form-control" name="user_template" rows="8" required>{{ (prompt.user_template if prompt else '') }}</textarea>
        <div class="form-text">
          Jinja2 шаблон. Пример: <code>Привет, {{ "{{name}}" }}! Составь план на день.</code>
        </div>
      </div>

      <button class="btn btn-primary" type="submit">{% if mode == "create" %}Создать{% else %}Сохранить{% endif %}</button>
    </form>
  </div>
</div>
{% endblock %}


